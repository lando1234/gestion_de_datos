-- LOGIN
CREATE PROCEDURE LOGIN @USERNAME NVARCHAR(255), @PASS NVARCHAR(255), @RESULT int OUTPUT
AS
BEGIN
DECLARE @ID INT, @USER NVARCHAR(255),@PASSWORD NVARCHAR(255), @REINTENTOS INT

SELECT 
@ID = USUARIO_ID,
@USER = USERNAME,
@PASSWORD = PASS,
@REINTENTOS = LOGIN_FALLIDO
FROM [NO_SRTA_E_GATOREI].USUARIOS
WHERE USERNAME = @USERNAME

IF @ID IS NULL
    BEGIN
    RETURN -1;
    END

ELSE IF @REINTENTOS >= 3
	BEGIN
	RETURN -2;
	END

ELSE IF @PASSWORD <> @PASS
	BEGIN
	UPDATE [NO_SRTA_E_GATOREI].[USUARIOS]
	SET LOGIN_FALLIDO = LOGIN_FALLIDO + 1
	WHERE USUARIO_ID = @ID
	RETURN -3;
	END
ELSE 
	BEGIN
	UPDATE [NO_SRTA_E_GATOREI].[USUARIOS]
	SET LOGIN_FALLIDO = 0
	WHERE USUARIO_ID = @ID
    
    SELECT @RESULT = @ID
	RETURN 0;
	END
END

GO
/*
recupera password, id, contador con el username

si tiene 3 o mas intentos
    excepcion

si la pass coincide
    blanquea contador
    devuelve usuario

si la pass no coincide
    suma al contador
    devuelve vacio
--
-- CREAR USUARIO CLIENTE CLIENTE
RECIBE USERNAME PASS ROL NOMBRE APELLIDO DNI MAIL TELEFONO DIRECCION CP FECHA_NACIMIENTO

CREA USUARIO
CREA RELACION CON ROL
LLAMAR A CREAR CLIENTE
INSERT EN CLIENTE 
INSERT EN CREDITO

-- CREAR USUARIO PROVEEDOR
RECIBE USERNAME PASS ROL RS CUIT MAIL TELEFONO DIRECCION CP CIUDAD RUBRO NOMBRECONTACTO

CREA USUARIO
CREA RELACION CON ROL
INSERT EN PROVEEDOR

-- CARGAR CREDITO
RECIBE FECHA CLIENTE TIPOPAGO MONTO NOMBRE NUMERONUMEROTARJETA FECHAVENCIMIENTO

INSERT EN TARJETA
INSERT EN CREDITO


--FACTURAR PROVEEDOR
RECIBE PROVEEDOR FECHADESDE FECHAHASTA

devuelve factura importe


--
*/
